<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png"/><link rel="manifest" href="/favicon/site.webmanifest"/><link rel="mask-icon" href="/favicon/safari-pinned-tab.svg" color="#000000"/><link rel="shortcut icon" href="/favicon/favicon.ico"/><meta name="msapplication-TileColor" content="#000000"/><meta name="msapplication-config" content="/favicon/browserconfig.xml"/><meta name="theme-color" content="#000"/><meta name="og:sitename" content="Donghun Kim | Developer"/><link rel="alternate" type="application/rss+xml" href="/feed.xml"/><meta name="google-site-verification" content="l9pNikVAOmXekB00LXYnclf9f_nyVIIjDvu4s2DdYtQ"/><title>Sky Palette Project: 2. Sky Images are Different</title><meta name="description" content="Continuing on the sky palette project, I started to go deeper into how I can best capture the colors in the sky. I tested with various algorithms, but nothing seemed to work really well. Different from other images, the sky had small details in the image that made the color very comprehensive. If I could capture the very details, I thought the there would be progress"/><meta name="title" content="Sky Palette Project: 2. Sky Images are Different"/><meta property="og:image" content="https://donghunkim.dev/assets/posts/sky_palette/segmented_image.jpg"/><meta name="next-head-count" content="18"/><link data-next-font="" rel="preconnect" href="/" crossorigin="anonymous"/><link rel="preload" href="/_next/static/css/bf017daba7196a90.css" as="style" crossorigin=""/><link rel="stylesheet" href="/_next/static/css/bf017daba7196a90.css" crossorigin="" data-n-g=""/><link rel="preload" href="/_next/static/css/cb3b4c67db54fe91.css" as="style" crossorigin=""/><link rel="stylesheet" href="/_next/static/css/cb3b4c67db54fe91.css" crossorigin="" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" crossorigin="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-8fa1640cc84ba8fe.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/framework-66d32731bdd20e83.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/main-bac2f07e2c919777.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/pages/_app-69f1be17496ca5f6.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/317522db-a1e300886af6caee.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/996-2621915a071d1e63.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/661-9dc76bc2b886effb.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/pages/posts/%5Bslug%5D-cddfbb9efefd55ab.js" defer="" crossorigin=""></script><script src="/_next/static/ese_kNW3Qfyez4YMrt9g1/_buildManifest.js" defer="" crossorigin=""></script><script src="/_next/static/ese_kNW3Qfyez4YMrt9g1/_ssgManifest.js" defer="" crossorigin=""></script></head><body class="bg-[#F1F1F1]"><div id="__next"><div class="min-h-screen text-[#000000]"><main><div class="container mx-auto px-5 max-w-5xl"><h2 class="text-2xl md:text-4xl font-bold tracking-tight md:tracking-tighter leading-tight mb-20 mt-8"><a href="/posts"><div class="hover:underline">← More Posts</div></a></h2><article class="mb-32"><h1 class="max-w-3xl mx-auto text-5xl md:text-6xl lg:text-6xl font-bold tracking-normal leading-10 md:leading-none mb-12 text-center md:text-left">Sky Palette Project: 2. Sky Images are Different</h1><div class="max-w-3xl mx-auto"><div class="mb-6 text-lg"><div>Written by <!-- -->Kim Dong Hun</div><div>2023-08-20</div></div></div><div class="max-w-3xl mx-auto"><div class="mb-6 text-lg"><div>Category:<!-- --> <span>#<!-- -->project</span><span>#<!-- -->AI</span><span>#<!-- -->color</span></div></div></div><div class="max-w-3xl mx-auto"><div class="markdown-styles_markdown__4D8Bm"><p>This post is a continuation of the <a href="./sky_palette_1">Sky Palette Project 1</a>.</p>
<h2>PCA Decomposition of the sky image</h2>
<p>
<img alt="2D PCA Decomposition" width="100%" src="/assets/posts/sky_palette/pca2.png">
<em>2D PCA Decomposition</em>
</p>
<p>Continuing where I took off last night, I started to go deeper into the analysis methods for the sky image. Last time, I tried with K-means clustering. However, since K-means clustering was simple average of the pixel rgb colors, I thought it was not the best way to capture the expressiveness of the sky image.</p>
<p>I first started with analyzing the PCA components of the image. They returned some interesting results, where I could see a beautiful gradient of the sky image. I wanted to extract those very colors that could make the gradient.</p>
<p>
<img alt="1D PCA Decomposition" width="100%" src="/assets/posts/sky_palette/pca1.png">
<em>1D PCA Decomposition</em>
</p>
<p>I tried to express the colors in one dimension too. They were not as beautiful as the 2D PCA, but I could see some gradient in the colors. I thought that if I could extract the colors in the gradient, I could make a beautiful palette.</p>
<p>
<img alt="PCA extraction for 5 colors" width="100%" src="/assets/posts/sky_palette/pca_extracted_5.jpg">
<em>PCA extraction for 5 colors</em>
</p>
<p>I did make a 5 color palette from the pca components. The colors seemed to represent the important colors in the sky image, however, there was a slight lack in perfection. For this particular sky image, I especially liked the red and purple gradient part, but this palette did not capture that part. However, according to the PCA analysis of the colors, the purple color and the blue color were considered to be very similar. Thus, it was difficult to capture both the dark blue and dark purple colors in the palette.</p>
<h2>SNIC segmentation of the sky image</h2>
<p>After much contemplation, I decided to try with another method. While I was staring at some sky images, I discovered that sky images had a positional difference in the colors. Since the sky image is basically a gradient, the colors in the sky image are different depending on the position of the image. I thought that if I could capture the positional difference, I could make a better palette.</p>
<p>
<img alt="PCA extraction for 5 colors" width="100%" src="/assets/posts/sky_palette/segmented.png">
<em>SNIC segmentation of the sky image</em>
</p>
<p>I started segmenting the sky image with a <a href="https://darshita1405.medium.com/superpixels-and-slic-6b2d8a6e4f08">SLIC algorithm</a>. The SLIC algorithm is a superpixel segmentation algorithm that segments the image into regions of similar colors. I thought that if I could segment the sky image into regions of similar colors, I could capture the positional difference in the sky image. I used the SLIC algorithm from the scikit-image library.</p>
<p>After segmenting the image, I extracted the colors from each segment. However, during the process, I came across with a question. "What if the sky image is not vertically aligned?" I thought that if the sky image was not vertically aligned, the colors would be different depending on the position of the image. Thus, I started to find ways to align the sky image vertically.</p>
<h2>Image Rotation with LAB Deconstruction</h2>
<p>
<img alt="LAB Deconstruction & Rotation" width="100%" src="/assets/posts/sky_palette/lab_deconsturction.png">
<em>LAB Deconstruction & Rotation</em>
</p>
<p>After much research, I found that LAB deconstruction is best for differentiating colors. So I first changed the rgb image into a lab image. After the deconstruction, I found that there were clear distinctions in color areas. Using a convolutional neural network, I calculated the gradients of each pixels. Then, I calculated the mean of the gradients to find the best rotation angle.</p>
<p>The rotation seemed to work. However, I soon found out that this was not applicable to all sky images. The biggest problem occurred when there were clouds. Since LAB takes lightness into its consideration, the clouds had a clear distinction with the atmosphere background color. Thus the rotation angle did not seem to work when there were many clouds. Thus I decided to forgo the attempt to align the sky image.</p>
<p>I started to go deeper into color segmentation using SNIC. Assuming that the sky image has a vertical color gradient, I grouped the segments according to the vertical position of the segment. Then, I extracted the colors from each group.</p>
<h2>Result Comparison</h2>
<p>
<img alt="Kmeans & SNIC compare" width="100%" src="/assets/posts/sky_palette/kmeans_snic_compare.png">
<em>Kmeans vs SNIC comparison</em>
</p>
<p>This is the result comparison of Kmeans (the algorithm I used in the last try) and SNIC. Now that the positional difference was considered, the colors seem to be more visually pleasing. However, if you see closely, you can see that Kmeans actually captured the representative colors better. While, the SNIC-produced colors seem to be more in harmony, there are some colors that SNIC could not catch while Kmeans could catch. Plus, SNIC works only when the sky image is vertically aligned.</p>
<p>After seeing the results, I started to think that maybe I should not segment the sky image. Though positional information would be great, the positional information cannot be applied to all sky images. Moreover, positional information may lead to ignoring the impressive color parts in the sky image. For instance, if there is more blue in the sky image, most of the colors in the palette would be blue. I needed to think of another way to capture the colors in the sky image.</p>
<h2>Solutions?</h2>
<p>After much thought, I started to see the problem from a different perspective. I was consumed with the idea of preserving the spatial information of the image, but it seemed useless. I looked at the 2D PCA decomposition again. If only I could capture the colors in the 2D PCA decomposition, I could make a beautiful palette.</p>
<p>
<img alt="PCA extraction for 5 colors" width="100%" src="/assets/posts/sky_palette/radial_selection_pca.png">
<em>PCA extraction for 5 colors</em>
</p>
<p>Then, I suddenly thought of a new way to group the images in the PCA. <strong>Why don't I group the colors in the PCA radially?</strong> Starting from the middle of the PCA, I could group the colors in the PCA radially. This would be great for capturing anomalies since the anomalies would be in the outer part of the PCA. I will try this method next time!</p>
<p>You can see my code for this project <a href="https://github.com/hunkim98/sky-palette">here</a>.</p>
</div></div><div class="max-w-3xl mx-auto mt-16 mb-16"><div class="flex justify-between w-full mb-20 flex-wrap"><a href="/posts/sky_palette_1" class="bg-white rounded-lg md:hover:scale-[1.01] transition hover:shadow-lg duration-200 cursor-pointer drop-shadow-md p-3 mb-3"><div>Previous</div><div class="text-sm font-bold text-left">← <!-- -->Sky Palette Project: 1. The Beginning of the Journey</div></a><a href="/posts/vae_overview" class="ml-auto bg-white rounded-lg md:hover:scale-[1.01] transition hover:shadow-lg duration-200 cursor-pointer drop-shadow-md p-3 mb-3"><div class="text-right">Next</div><div class="text-sm font-bold text-right">VAE the basics<!-- --> →</div></a></div></div><section></section></article></div></main></div></div><script id="__NEXT_DATA__" type="application/json" crossorigin="">{"props":{"pageProps":{"post":{"title":"Sky Palette Project: 2. Sky Images are Different","date":"2023-08-20","slug":"sky_palette_2","author":{"name":"Kim Dong Hun"},"content":"\u003cp\u003eThis post is a continuation of the \u003ca href=\"./sky_palette_1\"\u003eSky Palette Project 1\u003c/a\u003e.\u003c/p\u003e\n\u003ch2\u003ePCA Decomposition of the sky image\u003c/h2\u003e\n\u003cp\u003e\n\u003cimg alt=\"2D PCA Decomposition\" width=\"100%\" src=\"/assets/posts/sky_palette/pca2.png\"\u003e\n\u003cem\u003e2D PCA Decomposition\u003c/em\u003e\n\u003c/p\u003e\n\u003cp\u003eContinuing where I took off last night, I started to go deeper into the analysis methods for the sky image. Last time, I tried with K-means clustering. However, since K-means clustering was simple average of the pixel rgb colors, I thought it was not the best way to capture the expressiveness of the sky image.\u003c/p\u003e\n\u003cp\u003eI first started with analyzing the PCA components of the image. They returned some interesting results, where I could see a beautiful gradient of the sky image. I wanted to extract those very colors that could make the gradient.\u003c/p\u003e\n\u003cp\u003e\n\u003cimg alt=\"1D PCA Decomposition\" width=\"100%\" src=\"/assets/posts/sky_palette/pca1.png\"\u003e\n\u003cem\u003e1D PCA Decomposition\u003c/em\u003e\n\u003c/p\u003e\n\u003cp\u003eI tried to express the colors in one dimension too. They were not as beautiful as the 2D PCA, but I could see some gradient in the colors. I thought that if I could extract the colors in the gradient, I could make a beautiful palette.\u003c/p\u003e\n\u003cp\u003e\n\u003cimg alt=\"PCA extraction for 5 colors\" width=\"100%\" src=\"/assets/posts/sky_palette/pca_extracted_5.jpg\"\u003e\n\u003cem\u003ePCA extraction for 5 colors\u003c/em\u003e\n\u003c/p\u003e\n\u003cp\u003eI did make a 5 color palette from the pca components. The colors seemed to represent the important colors in the sky image, however, there was a slight lack in perfection. For this particular sky image, I especially liked the red and purple gradient part, but this palette did not capture that part. However, according to the PCA analysis of the colors, the purple color and the blue color were considered to be very similar. Thus, it was difficult to capture both the dark blue and dark purple colors in the palette.\u003c/p\u003e\n\u003ch2\u003eSNIC segmentation of the sky image\u003c/h2\u003e\n\u003cp\u003eAfter much contemplation, I decided to try with another method. While I was staring at some sky images, I discovered that sky images had a positional difference in the colors. Since the sky image is basically a gradient, the colors in the sky image are different depending on the position of the image. I thought that if I could capture the positional difference, I could make a better palette.\u003c/p\u003e\n\u003cp\u003e\n\u003cimg alt=\"PCA extraction for 5 colors\" width=\"100%\" src=\"/assets/posts/sky_palette/segmented.png\"\u003e\n\u003cem\u003eSNIC segmentation of the sky image\u003c/em\u003e\n\u003c/p\u003e\n\u003cp\u003eI started segmenting the sky image with a \u003ca href=\"https://darshita1405.medium.com/superpixels-and-slic-6b2d8a6e4f08\"\u003eSLIC algorithm\u003c/a\u003e. The SLIC algorithm is a superpixel segmentation algorithm that segments the image into regions of similar colors. I thought that if I could segment the sky image into regions of similar colors, I could capture the positional difference in the sky image. I used the SLIC algorithm from the scikit-image library.\u003c/p\u003e\n\u003cp\u003eAfter segmenting the image, I extracted the colors from each segment. However, during the process, I came across with a question. \"What if the sky image is not vertically aligned?\" I thought that if the sky image was not vertically aligned, the colors would be different depending on the position of the image. Thus, I started to find ways to align the sky image vertically.\u003c/p\u003e\n\u003ch2\u003eImage Rotation with LAB Deconstruction\u003c/h2\u003e\n\u003cp\u003e\n\u003cimg alt=\"LAB Deconstruction \u0026 Rotation\" width=\"100%\" src=\"/assets/posts/sky_palette/lab_deconsturction.png\"\u003e\n\u003cem\u003eLAB Deconstruction \u0026 Rotation\u003c/em\u003e\n\u003c/p\u003e\n\u003cp\u003eAfter much research, I found that LAB deconstruction is best for differentiating colors. So I first changed the rgb image into a lab image. After the deconstruction, I found that there were clear distinctions in color areas. Using a convolutional neural network, I calculated the gradients of each pixels. Then, I calculated the mean of the gradients to find the best rotation angle.\u003c/p\u003e\n\u003cp\u003eThe rotation seemed to work. However, I soon found out that this was not applicable to all sky images. The biggest problem occurred when there were clouds. Since LAB takes lightness into its consideration, the clouds had a clear distinction with the atmosphere background color. Thus the rotation angle did not seem to work when there were many clouds. Thus I decided to forgo the attempt to align the sky image.\u003c/p\u003e\n\u003cp\u003eI started to go deeper into color segmentation using SNIC. Assuming that the sky image has a vertical color gradient, I grouped the segments according to the vertical position of the segment. Then, I extracted the colors from each group.\u003c/p\u003e\n\u003ch2\u003eResult Comparison\u003c/h2\u003e\n\u003cp\u003e\n\u003cimg alt=\"Kmeans \u0026 SNIC compare\" width=\"100%\" src=\"/assets/posts/sky_palette/kmeans_snic_compare.png\"\u003e\n\u003cem\u003eKmeans vs SNIC comparison\u003c/em\u003e\n\u003c/p\u003e\n\u003cp\u003eThis is the result comparison of Kmeans (the algorithm I used in the last try) and SNIC. Now that the positional difference was considered, the colors seem to be more visually pleasing. However, if you see closely, you can see that Kmeans actually captured the representative colors better. While, the SNIC-produced colors seem to be more in harmony, there are some colors that SNIC could not catch while Kmeans could catch. Plus, SNIC works only when the sky image is vertically aligned.\u003c/p\u003e\n\u003cp\u003eAfter seeing the results, I started to think that maybe I should not segment the sky image. Though positional information would be great, the positional information cannot be applied to all sky images. Moreover, positional information may lead to ignoring the impressive color parts in the sky image. For instance, if there is more blue in the sky image, most of the colors in the palette would be blue. I needed to think of another way to capture the colors in the sky image.\u003c/p\u003e\n\u003ch2\u003eSolutions?\u003c/h2\u003e\n\u003cp\u003eAfter much thought, I started to see the problem from a different perspective. I was consumed with the idea of preserving the spatial information of the image, but it seemed useless. I looked at the 2D PCA decomposition again. If only I could capture the colors in the 2D PCA decomposition, I could make a beautiful palette.\u003c/p\u003e\n\u003cp\u003e\n\u003cimg alt=\"PCA extraction for 5 colors\" width=\"100%\" src=\"/assets/posts/sky_palette/radial_selection_pca.png\"\u003e\n\u003cem\u003ePCA extraction for 5 colors\u003c/em\u003e\n\u003c/p\u003e\n\u003cp\u003eThen, I suddenly thought of a new way to group the images in the PCA. \u003cstrong\u003eWhy don't I group the colors in the PCA radially?\u003c/strong\u003e Starting from the middle of the PCA, I could group the colors in the PCA radially. This would be great for capturing anomalies since the anomalies would be in the outer part of the PCA. I will try this method next time!\u003c/p\u003e\n\u003cp\u003eYou can see my code for this project \u003ca href=\"https://github.com/hunkim98/sky-palette\"\u003ehere\u003c/a\u003e.\u003c/p\u003e\n","keyword":"vision","categories":["project","AI","color"],"thumbnail":"/assets/posts/sky_palette/segmented_image.jpg","excerpt":"Continuing on the sky palette project, I started to go deeper into how I can best capture the colors in the sky. I tested with various algorithms, but nothing seemed to work really well. Different from other images, the sky had small details in the image that made the color very comprehensive. If I could capture the very details, I thought the there would be progress","nextPath":"/posts/vae_overview","prevPath":"/posts/sky_palette_1","prevTitle":"Sky Palette Project: 1. The Beginning of the Journey","nextTitle":"VAE the basics"}},"__N_SSG":true},"page":"/posts/[slug]","query":{"slug":"sky_palette_2"},"buildId":"ese_kNW3Qfyez4YMrt9g1","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>